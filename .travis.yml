dist: xenial
language: python
services:
- docker
install:
- pip install -r requirements.txt --ignore-installed
script:
- make test
jobs:
  include:
  - stage: test
    script: "/bin/true"
    name: Run Unit Tests
  # - stage: docker-login
  #   script: echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    if: branch = master AND type = push AND sender = tmacro
  - stage: release-edge
    script: make DEFAULT_DOCKER_TAG=edge DOCKER_TAG_VERSION= release-docker
    name: Build and release docker "edge" image
  - stage: release
    script: make release
stages:
- test
- docker-login
- name: release-edge
  if: branch = master AND type = push AND sender = tmacro AND tag IS blank
- name: release
  if: branch = master AND type = push AND sender = tmacro AND tag IS present
env:
  global:
  - secure: fL7diVhkIgFXk4xN5fe38mN8ZgtmzIX1mcEFSv514g71uHX7lf962UJYYLQkLsGOspBkWhkvII/ZuWSaCxngxflKqVnqFW81w/5oUuNntR50FRo+fssEpHzhLzMDxSGIbDJMzcHxpQYFyyKrN88WE0cByLgV2E3/n42Q6dRVESvjb5AD4kqxlFoesmmpJITXnxs4f6oi4sJCWQl7CW3Vetu7orfH63vfZF+pHCTo0paox/dR/U9y4elqk495gsE3VBqICw7BPzoTe+tteqg10HLrk16foF5sQ0nugfzZsB39449RntpV7CwMF3m6gMh21xXVYU3ALVbjJSZ5rA4JR+k2+N1LVphznQYcWn3WFgISEeDaTTF+wvv6UflqhnBMChl4VjlW8ykadhid95j5TgGAME36JIDGlZ0x8plFEBnkKxrVihDaAICHDKX0stqm+7/uufU+1LDlUdfIee1dxdm6jbBCyJBjRXSwAKwmtdTTRorJd8p04zU71tRET2vXPlvGL2SGIuuFDKKB7lHF0b1lzRsllmyTTwqbBtg8MdCHTx9NUKahyhRvRPWuP3DRi/e/X4T/7FPcIj0m1UUv3sJqN+kGY4ZTmn0vjuS6j2/jY6iBjK+oyMvzq3PsEawF73Ly1m1t8h/lVXG89ZCbeLiVt/Kn95DlnIoqoETJHP8=
  - secure: EN8eS464tidzWcYnw5WCp5BPlWBnoCp4bLG0Hy52tHqmxAFUhdIABaUvy7KIdxLYNn/82/ptu4z0kMVHL8F8Oganx86YmDNlBzhwhX097DVA7nppzMJ16pGBZ4Ql+qRipcUONFC3raN69ytHTIrGD3OZA/7rgpr8+33zbp4ecuIyZuJMq0mAogT4M30kbx10Ph1Zx0qp82gJgs3b+Zu1RH7ivW9e5USbI8fb9aSFq8jKoYxzYEXDhrxRcHn8EIcyW2PYB0b9yF18DnFZFJtEjCbfujUjNk7s2P2u5GtPVGGr/qyfeeArp7ZDk4dll1A4PYq9HFT9OoXkm32m+AHWcWwMT6XqTPkKRNIInyTLSvKPIlaoVAxk/0CRYCKetf+rEurO8ODc/njGDOsH2EXppRNM2LJu9V3hUFLs9WV5g3Xdx8ZeWAmI6AMb2oQS3nlHy+cruZqp9L1ZIyeRK9BTqsE0jqc8qY47bSOlIM7p6d7qVEaHQmY9DM6rIvYFu95WEEkAGF2g8CQM9U+X6yx5bM8NU1A2qGBacbO7n1mjGJXAEtr3SmEMKaY7yv/6qbe/4PuMq2ARxtsbac2hfgVIheDbbghsyPx9s6AFPvhDcJdH1pqYfMdBDiU2OxvbhDohrT1UfwlMuXWHgW66MGU2adWi1RCfG1SKWp/+fX3kNFE=
